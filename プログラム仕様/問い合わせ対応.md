# メール自動対応システム

## システム概要
顧客からの問い合わせメールを1件ずつリアルタイムに受け取り、  
「自動回答生成」または「担当部署の割り当て」を判断し、結果を出力する。

---

### 0. RAGのインデックス登録 関数
**引数**
- RAGデータ用のcsv（ファイルパス）

**処理フロー**
1. 「本文」をベクトル化  
2. 1行1チャンクとしてインデックス登録  
3. 登録項目  
   - ユニークID  
   - 本文（検索の対象）  
   - 本文のベクトル（検索の対象）  
   - カテゴリ（メタデータ）  
   - 担当課のラベル（メタデータ）  
   - 回答内容（メタデータ）  

---

### 1. メイン処理 関数
**引数**
- カテゴリ（文字列）
- 本文（文字列）

**処理フロー**
1. 類似QA検索 関数  
2. 回答可能な場合 → 自動返信生成 関数  
3. 回答不可能な場合 → 担当部署割り振り関数  
4. 結果をcsvの新規カラムに追加  

**戻り値**
- 返信メール（文字列） or 担当部署（文字列）

---

### 2. 類似QA検索 関数
**引数**
- カテゴリ（文字列）
- 本文（文字列）

**処理フロー**
1. 本文をベクトル化  
2. RAGのDBからベクトル検索（本文とDB本文のコサイン類似度）で上位N件を取得  
3. カテゴリで検索フィルタリング  
4. 取得チャンク（本文・回答）をLLMに入力して回答可能か判定  
   - 回答可能 → true  
   - 回答不可能 → false  

**戻り値**
- 回答可能かどうか（真偽値）  
- 検索で取得したチャンク（担当部署・本文・回答・類似度を含む辞書リスト）

---

### 3. 自動返信生成 関数
**引数**
- 本文（文字列）
- 検索で取得したチャンク（辞書リスト）

**処理フロー**
- LLMで「本文」に対する回答を「検索で取得したチャンク」を参照して生成  

**戻り値**
- 返信メール（文字列）

---

### 4. 担当部署割り振り関数
**引数**
- 本文（文字列）
- 検索で取得したチャンク（辞書リスト）

**処理フロー**
- LLMで「本文」をもとに担当すべき部署を選定  

**戻り値**
- 担当部署（文字列）